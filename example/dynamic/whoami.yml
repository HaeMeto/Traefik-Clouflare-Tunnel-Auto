http:
  middlewares:
    redirect-to-https:
      redirectScheme:
        scheme: https

    default-whitelist:
      ipAllowList:
        sourceRange:
        - "10.0.0.0/8"
        - "192.168.0.0/16"
        - "172.16.0.0/12"
        - 127.0.0.1/8        # <— tambah loopback
        - 100.64.0.0/10       # <— tambah range Tailscale
        - ::1/128             # <— kalau klien pakai IPv6 loopback  
    default-headers:
      headers:
        frameDeny: true
        browserXssFilter: true
        contentTypeNosniff: true
        forceSTSHeader: true
        stsIncludeSubdomains: true
        stsPreload: true
        stsSeconds: 15552000
        customFrameOptionsValue: SAMEORIGIN
        customRequestHeaders:
          X-Forwarded-Proto: https

  routers:
    # === PUBLIC ===
    whoami:
      rule: "Host(`whoami.example.id`)"
      entryPoints:
        - websecure
      service: whoami-service
      tls:
        certResolver: cloudflare

    # === LOCAL  ===
    whoami-lan:
      rule: "Host(`whoami.local.id`)"
      entryPoints: ["websecure","office"] 
      middlewares: ["default-whitelist"]
      service: whoami-svc
      tls: 
          # pertama dns chalange untuk buat certifikat
          certResolver: cloudflare
          domains:
            - main: "domain.id"
              sans: ["*.local.domain.id"]

  services:
    whoami-service:
      loadBalancer:
        passHostHeader: false
        servers:
          - url: "http://whoami:80"
   
